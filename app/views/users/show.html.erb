<%= render "users/shared/profile" %>
<% if @user.has_role? :employee %>
<!-- Employee Profile -->
 		<% suclass = "tab-pane fade" %>
    	<% apclass = "tab-pane fade" %>
    	<% prclass = "tab-pane fade" %>
    	<% skclass = "tab-pane fade" %>
    	<% reclass = "tab-pane fade" %>
    <% if user_signed_in? && current_user==@user %>
		<%= render "users/shared/job_seeker_home_tabs" %>			
  		<% if session[:home_tab] == "applications" && user_signed_in? && current_user==@user %>
  			<% apclass = apclass + " in active" %>
  		<% elsif session[:home_tab] == "projects" && current_user==@user %>
  			<% prclass = prclass + " in active" %>
  		<% elsif session[:home_tab] == "skills" && current_user==@user %>
  			<% skclass = skclass + " in active" %>
  		<% elsif session[:home_tab] == "references" && current_user==@user %>
  			<% reclass = reclass + " in active" %>
  		<% else %>
  			<% suclass = suclass + " in active" %>
  		<% end %>
  	<% else %>
			<%= render partial: "shared/job_seeker_tabs", locals: {active: session[:nav_tab]} %>			
  		<% if session[:nav_tab] == "projects" %>
  			<% prclass = prclass + " in active" %>
  		<% elsif session[:nav_tab] == "skills"  %>
  			<% skclass = skclass + " in active" %>
  		<% elsif session[:nav_tab] == "references" %>
  			<% reclass = reclass + " in active" %>
  		<% else %>
  			<% suclass = suclass + " in active" %>
  		<% end %>
  	<% end %>
  		<div class="tab-content profileButtonContent">
    		<div id="surveys" class= "<%= suclass %>">
      			<div class = "survey-table" id= "survey-table">
      				<% if current_user == @user %>
      					<h4>These are your surveys.</h4>
							<p>Click on one of the boxes below to fill out a survey to showcase some of your skills.  Each graph shows the skills that an average person has (in red) and the skills you've indicated (in blue).</p>
					<% else %>
						<h4>These are <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> surveys</h4>
							<p>Each graph will show an average person's skills (in red) versus <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> skills, in blue, if the survey has been completed.</p>
					<% end %>
					<%= render '/users/partials/show_survey_table', user:@user, results:@survey_results %>
				</div>
			</div>
    		<% if user_signed_in? && @current_user==@user %>
    			<div id="applications" class="<%= apclass %>">
					<% cnt = 0 %>
					<h4>These are your current job applications.</h4>
					<p> The status is displayed beside the posting title.<br>
						The company which owns the job posting will update the status of the posting and it will be shown here.<br>
						You have the option to delete your application but <b>you will not be able to reapply if the application has been looked at.</b><br>
						Feel free to delete your application if you are rejected but keep in mind that it is possible for a company to change their mind and "unreject" your application.
					</p>
					<%@job_posting_applications.each do |j|%>
						<% if j.status != -2 %>
							<% cnt += 1 %>
							<div class="row alternate"> 
								<div class="col-md-5">
									<h4 class="job-application-content">
										<%= link_to raw("#{j.job_posting.title} (<i>#{j.job_posting.user.company_name}</i>)"), job_posting_application_path(j) %>
										<span class=" label label-<%=j.get_bootstrap_status%>"><%="#{j.get_status_string}"%></span>
									</h4>
								</div>
								<div class="col-md-1">
									<%= link_to "Delete", job_posting_application_path(j.id), data: {confirm: "Are you sure you want to delete this application?"}, method: "delete", class: "btn btn-danger", id: "delete_job_application"%>
								</div>
							</div>
						<% end %>
					<% end %>
				</div>
    		<% end %>
    		<div id="projects" class="<%= prclass %>">
    			<% if current_user == @user %>
      				<h4>These are your projects.</h4>
						<p>Click on New Project to create a new one, or view, edit, or delete the projects listed below.  Projects are sorted
						by their date.</p>
				<% else %>
					<h4>These are <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> projects</h4>
						<p>Projects are sorted by their date.</p>
				<% end %>
    			<% if user_signed_in? && @current_user==@user %>
					<div class="row">
						<%= link_to "New Project", new_project_path, class: "btn btn-primary" %>
					</div>
					<br />
				<% end %>
				<% if !@projects.empty? %>
					<div class="projects">
						<% @projects.each do |p| %>
							<div class="row alternate" style="padding-bottom: 5px">
								<div class="col-md-1">
									<%= p.project_date.strftime('%B')+", "+p.project_date.strftime('%Y') %>
								</div>
								<div class="col-md-3">
									<%= image_tag p.image.url(:medium) %>
								</div>
								<div class="col-md-5">
									<h2><%= p.title %></h2>
									<p><%= p.description %></p>
									<% index = 1 %>
									<% if !@skills[p.id].empty? %>
										<p>Skills associated with this project:</p>
										<div class="row">
											<div class="col-md-12">
												<% @skills[p.id].each do |s| %>
													<% if index < @skills[p.id].length %>
														<%= s.name.titleize+", " %>
														<% index = index+1 %>
													<% else %>
														<%= s.name.titleize %>
													<% end %>
												<% end %>
											</div>
										</div>
									<% end %>
								</div>
								<% if user_signed_in? && @current_user==@user %>
									<div class="col-md-3">
										<%= link_to "Edit", edit_project_path(p), class: "btn btn-warning", id: "edit_project" %>
										<%= link_to "Delete", p, method: :delete, data: {confirm: 'Are you sure you want to delete this project?'}, class: "btn btn-danger", id: "delete_project" %>
									</div>
								<% end %>
							</div>
						<% end %>
					</div>
				<% else %>
					<h3>There are no posted projects yet!</h3>
				<% end %>
			</div>
    		<div id="skills" class="<%= skclass %>">
    			<% if current_user == @user %>
      				<h4>These are your skills.</h4>
						<p>Create a new skill by filling out the info below, or view your skills listed below.</p>
				<% else %>
					<h4>These are <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> skills</h4>
						<p>This is a summary of all of <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> skills, organized by
						categories they specified.</p>
				<% end %>
    			<% if user_signed_in? && @current_user==@user %>
						<%= simple_form_for @user_skill do |g| %>
							<div class="row">
								<div class="col-md-4"><%= g.input :name %>	</div>
								<div class="col-md-4"><%= g.input :survey_id, required:true, collection: @surveys, prompt: "Select Classification", label: "Associated Survey Skill"%></div>
							</div>
							<br />
							<%= g.button :submit, class: "btn btn-primary" %>
						<% end %>
					<% end %>
				<div id="skills">
					<div class="container">
						<div class ="row survey-box-row">
							<div class="col-md-1"></div>
							<% j=1 %>
							<% Survey.all.each do |s|%>
								<div class="col-md-2" style="min-height: 150px">
									<h5><u><%= s.title %></u></h5>
									<% if  @user_skills.where(survey_id: s.id).empty? %>
										<p>No skills for this category yet</p>
									<% else%>
										<ul>
											<% @user_skills.where(survey_id: s.id).each do |sk| %>
												<li class="skill alternate">
													<%= sk.skill.name.titleize %>
												</li>
											<% end %>
										</ul>
									<% end %>
								</div>
								<div class="col-md-1"></div>
								<% if j % 3 == 0 && j < 12 %>
									</div>
									<div class ="row survey-box-row"> 
										<div class="col-md-1"></div>
								<% end %>
								<% j += 1 %>
							<% end %>
						</div>
					</div>
				</div>
    		</div>
			<div id="references" class="<%= reclass %>">
				<% if current_user == @user %>
      				<h4>These are your references.</h4>
						<p>You can request one by clicking the button below.  References are split into Confirmed References, these will be 
						displayed on your page, Unconfirmed References, references you have not confirmed yet and will not be displayed, and References 
						Requests, which are requests from other EdgeMap users wanting a reference.</p>
				<% else %>
					<h4>These are <%= @user.first_name.titleize+" "+@user.last_name.titleize+"'s "%> confirmed references</h4>
						<p>These are all the references <%= @user.first_name.titleize+" "+@user.last_name.titleize %> has contacted and received.</p>
				<% end %>
				<div class = "references" id = "references">
					<div class="row">
						<% if user_signed_in? && @current_user==@user %>
							<%= link_to "Request a Reference", email_reference_path, class: "btn btn-primary" %>
						<% end %>
					</div>
					<hr class="HR"/>
					<div class="row">
						<div class="col-md-12">
							<% if current_user == @user %>
								<h4> Confirmed References </h4>
							<% end %>
							<% if !@confirmed_references.empty? %>
								<% @confirmed_references.each do |r| %>
									<div class ="row alternate" id="ref" style="padding-top:10px; padding-bottom: 10px;">
											<div class="col-md-2">
												<%= image_tag("avatar-placeholder-small.svg", class: "profile-image") %>
											</div>
											<div class="col-md-3">
												<div class="row">
													<h5><%= r.first_name%> <%= r.last_name %>
													<br /><%= r.position %>
													<br /><%= r.company%></h5>
												</div>
												<div class="row">
													<h5 class="refLeft"><b>Contact:</b></h5>
													<h5 class="refLeft contactElm">Email: <%= r.email %>
													<% if r.phone_number.empty? %>
														<% puts %> 
													<% else %>
														<br />Phone: <%= r.phone_number %>
													<% end %>
													</h5>
												</div>
											</div>
											<div class="col-md-4">
												<div class="row">
													<h5>Reference:</h5>
													<h5><%= r.reference_body %></h5>
												</div>
											</div>
										<% if user_signed_in? && @current_user==@user %>
											<div class="col-md-3">
												<div style="float:right;">
													<%= link_to "Unconfirm", update_reference_path(r), method: "patch", class: "btn btn-warning" %>
													<%= link_to "Delete", delete_reference_path(r), method: "delete", data: {confirm: "Are you sure you want to delete this reference?"}, class: "btn btn-danger" %>
												</div>
											</div>
										<% end %>
									</div>
								<% end %>
							<% else %>
								<% if current_user == @user %>
									<p> You have no confirmed references.  Confirm one or send someone a reference request.</p>
								<% else %>
									<p> There are no confirmed references yet.  Check back later.</p>
								<% end %>
							<% end %>
						</div>
					</div>
					<hr class="HR"/>
					<% if user_signed_in? && @current_user==@user %>
						<div class="row">
							<div class="col-md-12">
								<h4> Unconfirmed References </h4>
								<% if !@unconfirmed_references.empty? %>
									<% @unconfirmed_references.each do |r| %>
										<div class ="row alternate" id="ref2" style="padding-top:10px; padding-bottom: 10px;">
											<div class="col-md-2">
												<%= image_tag("avatar-placeholder-small.svg", class: "profile-image") %>
											</div>
											<div class="col-md-3">
												<div class="row">
													<h5><%= r.first_name%> <%= r.last_name %>
													<br /><%= r.position %>
													<br /><%= r.company%></h5>
												</div>
												<div class="row">
													<h5 class="refLeft"><b>Contact:</b></h5>
													<h5 class="refLeft contactElm">Email: <%= r.email %>
													<% if r.phone_number.empty? %>
														<% puts %> 
													<% else %>
														<br />Phone: <%= r.phone_number %>
													<% end %>
													</h5>
												</div>
											</div>
											<div class="col-md-4">
												<div class="row">
													<h5>Reference:</h5>
													<h5><%= r.reference_body %></h5>
												</div>
											</div>
											<div class="col-md-3">
												<div style="float:right;">
													<%= link_to "Confirm", update_reference_path(r), method: "patch", class: "btn btn-success" %>
													<%= link_to "Delete", delete_reference_path(r), method: "delete", data: {confirm: "Are you sure you want to delete this reference?"}, class: "btn btn-danger" %>
												</div>
											</div>
										</div>
									<% end %>
								<% else %>
									<p> You have no unconfirmed references. </p>
								<% end %>
							</div>
						</div>
						<hr class="HR"/>
						<div class="row">
							<div class="col-md-12">
								<h4> Reference Requests </h4>
								<% if !@reference_requests.empty? %>
									<% @reference_requests.each do |r| %>
										<div class ="row alternate" style="padding-top:10px; padding-bottom: 10px;">
											<div class="col-md-2">
												<%= image_tag r.user.image.url(:small), alt:"User Icon", class: "profile-image" %>
											</div>
											<div class="col-md-3">
												<div class="row">
													<h5><%= r.user.first_name%> <%= r.user.last_name %></h5>
												</div>
											</div>
											<div class="col-md-4">
												<div class="row">
													<h5>Message:</h5>
													<h5><%= r.message %></h5>
												</div>
											</div>
											<div class="col-md-3">
												<div style="float:right;">
													<%= link_to "View", user_path(r.user_id), class: "btn btn-primary"%>
													<%= link_to "Refer", new_reference_path(r.reference_url), class: "btn btn-success"%>
													<%= link_to "Delete", delete_reference_redirection_path(r), method: :delete, data: {confirm: "Are you sure you want to delete this request?"}, class: "btn btn-danger" %>
												</div>
											</div>
										</div>
									<% end %>
								<% else %>
									<p> You have no reference requests. </p>
								<% end %>
							</div>
						</div>
					<% end %>
				</div>
    		</div>
  		</div>
	</div>
<% elsif @user.has_role? :employer %>
  		<% aclass = "tab-pane fade" %>
    	<% jclass = "tab-pane fade" %>
		<% if user_signed_in? && current_user==@user %>
			<%= render "users/shared/employer_home_tabs" %>
  			<% if session[:home_tab] == "jobs" %>
  				<% jclass = jclass + " in active" %>
  			<% else %>
  				<% aclass = aclass + " in active" %>
  			<% end %>
		<% else %>
			<%= render partial: "shared/employer_tabs", locals: {active: session[:nav_tab]} %>
  			<% if session[:nav_tab] == "jobs" %>
  				<% jclass = jclass + " in active" %>
  			<% else %>
  				<% aclass = aclass + " in active" %>
  			<% end %>
		<% end %>
		<div class="tab-content profileButtonContent">

			<div id="about" class="<%= aclass %>">
				<h4>About <%= @user.company_name %> </h4>
				<% if user_signed_in? && current_user == @user %>
					<%= simple_form_for @user do |u| %>
						<%= u.input :bio, as: :text %>
						<%= u.submit "Update Bio", name: 'bio', class: "btn btn-primary"%>
					<% end %>
				<% else %>
					<%= @user.bio %>
				<% end %>
			</div>
			<div id="jobs" class="<%= jclass %>">
				<br>
				<% if user_signed_in? && current_user == @user %>
					<%= link_to "Create a New Posting", new_job_posting_path, class: "btn btn-primary" %><br>
				<% end %>
				<% if @job_postings.nil? %>
					<% if user_signed_in? && current_user == @user %>
						<p>You have no job postings.  Please create one below</p>
					<% else %>
						<p><%= @user.company_name %> has no job postings right now.  Check back leter.</p>
					<% end %>
				<% else %>
					<% @job_postings.each do |j| %>
						<div id="postings" class="row alternate">
							<div class="col-md-2">
								<%= link_to "#{j.title}\n", job_posting_path(j) %><br />
								<%= raw(j.get_type_string+"<br />") if !j.job_type.nil? %>
								<p><%= j.city %>, <%=j.province %></p>
							</div>
							<div class="col-md-4">
								<%= j.job_category.name %><br />
								<%= raw("Open date: #{j.open_date.strftime('%B %d, %Y')}<br>")   if !j.open_date.blank? %>
								<%= raw("Close date: #{j.close_date.strftime('%B %d, %Y')}<br>") if !j.close_date.blank? %>
							</div>
							<div class="col-md-6">
								<%= link_to "View", job_posting_path(j), class: "btn btn-primary" %>
								<% if user_signed_in? && current_user == @user %>
									<%= link_to "Edit Posting", edit_job_posting_path(j), class: "btn btn-warning"%>
									<% application_count = j.job_posting_applications.where(status:-1..Float::INFINITY).count %>
									<%= link_to raw("Applications <span class=\"badge\">#{application_count.to_s}</span>"), job_posting_applications_path(job_posting:j), class: "btn btn-success"%>						
									<%= link_to "Delete", job_posting_path(j), method: "delete", data: {confirm: "Are you sure you want to delete this posting?"}, class: "btn btn-danger"%>
								<% end %>
							</div>
						</div>
						<br>
					<% end %>
				<% end %>
			</div>
		</div>
	</div>

<% elsif @user.has_role? :admin%>
	You are an admin!
<% end %>

